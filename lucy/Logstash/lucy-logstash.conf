input {
    elasticsearch{
        id => "elastic to kafka"
        user => "${ELASTICSEARCH_USER}"
        password => "${ELASTICSEARCH_PASSWORD}"
        hosts => [${ELASTICSEARCH_HOSTS}]
        index => "quettai_tw_data"
        query => '{"query": { "query_string" : {"query" : "*"}}}'
        size => 100 
    }
}

filter {
    ruby {
        code => '
            ["wc_sitename", "au_url", "kw_docid", "version", "wc_boardname", "an_title", "wc_writer_nick", "timestamp"].each {
                |f| event.set(f, "") if event.get(f).nil?}        
        '
    }
}

output {
  stdout {
        codec => rubydebug
  }
  kafka {
    id => "kw_docid"
    codec => avro_schema_registry {
      endpoint => "${SCHEMA_REGISTRY}"
      schema_id => 5
    }
    topic_id => "lucy"
    bootstrap_servers => "${KAFKA_BOOTSTRAP_SERVERS}"
  }
}